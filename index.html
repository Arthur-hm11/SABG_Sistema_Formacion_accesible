

<script>
async function uploadPdf() {
  try {
    const input = document.getElementById("pdfFile");
    if (!input || !input.files || !input.files.length) return;

    const file = input.files[0];
    const fd = new FormData();
    fd.append("pdf", file, file.name);

    const r = await fetch("/api/evidencias/upload?cb=" + Date.now(), {
      method: "POST",
      body: fd
    });

    const j = await r.json().catch(() => ({}));
    if (!j.ok) throw new Error(j.error || "Error al subir evidencia");

    alert("✅ Evidencia subida.\nLink: " + (j.link || "(sin link)"));
    input.value = "";
  } catch (e) {
    console.error("❌ uploadPdf error:", e);
    alert("❌ No se pudo subir el PDF: " + (e?.message || e));
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("pdfFile");
  if (input && !input.__hasUploadPdf) {
    input.addEventListener("change", uploadPdf);
    input.__hasUploadPdf = true;
  }
});
</script>
